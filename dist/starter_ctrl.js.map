{"version":3,"sources":["../src/starter_ctrl.js"],"names":["MetricsPanelCtrl","_","$","TimeSeries","panelDefaults","bgColor","sparkline","show","full","lineColor","fillColor","StarterCtrl","$scope","$injector","defaultsDeep","panel","events","on","onInitEditMode","bind","onPanelTeardown","render","onDataReceived","onDataError","onDataSnapshotLoad","onSparklineColorChange","onSparklineFillChange","addEditorTab","dataList","data","map","seriesHandler","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","snapshotData","newColor","scope","elem","attrs","ctrl","$panelContainer","find","css","rootElem","addSparklines","width","setTimeout","empty","height","plotCanvas","plotCss","position","bottom","left","dynamicHeightMargin","Math","round","floor","options","legend","lines","fill","lineWidth","yaxes","xaxis","mode","min","range","from","valueOf","max","to","grid","hoverable","append","plotSeries","color","plot","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,sB,kBAAAA,gB;;AACDC,O;;AACAC,O;;AAEAC,gB;;;;;;;;;;;;;;;;;;;;;AAEDC,mB,GAAgB;AACpBC,iBAAS,IADW;AAEpBC,mBAAW;AACTC,gBAAM,IADG;AAETC,gBAAM,KAFG;AAGTC,qBAAW,mBAHF;AAITC,qBAAW;AAJF;AAFS,O;;6BAUTC,W;;;AACX,6BAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,gIACvBD,MADuB,EACfC,SADe;;AAG7B;AACAZ,YAAEa,YAAF,CAAe,MAAKC,KAApB,EAA2BX,aAA3B;;AAEA;AACA;AACA,gBAAKY,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;;AAEA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKG,eAAL,CAAqBD,IAArB,OAAjC;;AAEA;AACA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKI,MAAL,CAAYF,IAAZ,OAApC;;AAEA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKK,cAAL,CAAoBH,IAApB,OAAhC;;AAEA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,YAAf,EAA6B,MAAKM,WAAL,CAAiBJ,IAAjB,OAA7B;;AAEA;AACA;AACA,gBAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKO,kBAAL,CAAwBL,IAAxB,OAArC;;AAEA,gBAAKM,sBAAL,GAA8B,MAAKA,sBAAL,CAA4BN,IAA5B,OAA9B;AACA,gBAAKO,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BP,IAA3B,OAA7B;AA5B6B;AA6B9B;;;;2CAEgB;AACf,iBAAKQ,YAAL,CAAkB,SAAlB,EAA6B,kDAA7B,EAAiF,CAAjF;AACD;;;4CAEiB,CACjB;;;yCAEcC,Q,EAAU;AACvB,gBAAI,CAACA,QAAL,EAAe;;AAEf,iBAAKC,IAAL,GAAYD,SAASE,GAAT,CAAa,KAAKC,aAAL,CAAmBZ,IAAnB,CAAwB,IAAxB,CAAb,CAAZ;AACA,iBAAKE,MAAL;AACD;;;wCAEaW,U,EAAY;AACxB,gBAAIC,SAAS,IAAI9B,UAAJ,CAAe;AAC1B+B,0BAAYF,WAAWE,UAAX,IAAyB,EADX;AAE1BC,qBAAOH,WAAWI;AAFQ,aAAf,CAAb;;AAKAH,mBAAOI,SAAP,GAAmBJ,OAAOK,YAAP,CAAoB,KAAKvB,KAAL,CAAWwB,aAA/B,CAAnB;AACA,mBAAON,MAAP;AACD;;;wCAEa;AACZ,iBAAKX,cAAL;AACD;;;6CAEkBkB,Y,EAAc;AAC/B,iBAAKlB,cAAL,CAAoBkB,YAApB;AACD;;;iDAEsBC,Q,EAAU;AAC/B,iBAAK1B,KAAL,CAAWT,SAAX,CAAqBG,SAArB,GAAiCgC,QAAjC;AACA,iBAAKpB,MAAL;AACD;;;gDAEqBoB,Q,EAAU;AAC9B,iBAAK1B,KAAL,CAAWT,SAAX,CAAqBI,SAArB,GAAiC+B,QAAjC;AACA,iBAAKpB,MAAL;AACD;;;+BAMIqB,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAAA;;AAC7B,iBAAK7B,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAM;AAC7B,kBAAM6B,kBAAkBH,KAAKI,IAAL,CAAU,kBAAV,CAAxB;;AAEA,kBAAI,OAAKhC,KAAL,CAAWV,OAAf,EAAwB;AACtByC,gCAAgBE,GAAhB,CAAoB,kBAApB,EAAwC,OAAKjC,KAAL,CAAWV,OAAnD;AACD,eAFD,MAEO;AACLyC,gCAAgBE,GAAhB,CAAoB,kBAApB,EAAwC,EAAxC;AACD;;AAED,kBAAI,CAACH,KAAKhB,IAAV,EAAgB;AACd;AACD;;AAED,kBAAMoB,WAAWN,KAAKI,IAAL,CAAU,iBAAV,CAAjB;;AAEAG,4BAAcD,QAAd;AACD,aAhBD;;AAkBA,qBAASC,aAAT,CAAuBD,QAAvB,EAAiC;AAC/B,kBAAME,QAAQR,KAAKQ,KAAL,KAAe,EAA7B;AACA,kBAAIA,QAAQ,EAAZ,EAAgB;AACd;AACA;AACAC,2BAAW;AAAA,yBAAMF,cAAcD,QAAd,CAAN;AAAA,iBAAX,EAA0C,EAA1C;AACA;AACD;;AAEDA,uBAASI,KAAT;;AAEA,kBAAMC,SAAST,KAAKS,MAApB;AACA,kBAAMC,aAAarD,EAAE,aAAF,CAAnB;AACA,kBAAMsD,UAAU,EAAhB;AACAA,sBAAQC,QAAR,GAAmB,UAAnB;;AAEA,kBAAIZ,KAAK9B,KAAL,CAAWT,SAAX,CAAqBE,IAAzB,EAA+B;AAC7BgD,wBAAQE,MAAR,GAAiB,KAAjB;AACAF,wBAAQG,IAAR,GAAe,MAAf;AACAH,wBAAQL,KAAR,GAAgBA,QAAQ,EAAR,GAAa,IAA7B;AACA,oBAAMS,sBAAsBN,UAAU,GAAV,GAAgB,CAAhB,GAAoBO,KAAKC,KAAL,CAAWR,SAAS,GAApB,IAA2B,EAA3B,GAAgC,CAAhF;AACAE,wBAAQF,MAAR,GAAiBA,SAASM,mBAAT,GAA+B,IAAhD;AACD,eAND,MAMO;AACLJ,wBAAQE,MAAR,GAAiB,KAAjB;AACAF,wBAAQG,IAAR,GAAe,MAAf;AACAH,wBAAQL,KAAR,GAAgBA,QAAQ,EAAR,GAAa,IAA7B;AACAK,wBAAQF,MAAR,GAAiBO,KAAKE,KAAL,CAAWT,SAAS,IAApB,IAA4B,IAA7C;AACD;;AAEDC,yBAAWP,GAAX,CAAeQ,OAAf;;AAEA,kBAAMQ,UAAU;AACdC,wBAAQ,EAAE1D,MAAM,KAAR,EADM;AAEd0B,wBAAQ;AACNiC,yBAAO;AACL3D,0BAAM,IADD;AAEL4D,0BAAM,CAFD;AAGLC,+BAAW,CAHN;AAIL1D,+BAAWmC,KAAK9B,KAAL,CAAWT,SAAX,CAAqBI;AAJ3B;AADD,iBAFM;AAUd2D,uBAAO,EAAE9D,MAAM,KAAR,EAVO;AAWd+D,uBAAO;AACL/D,wBAAM,KADD;AAELgE,wBAAM,MAFD;AAGLC,uBAAK3B,KAAK4B,KAAL,CAAWC,IAAX,CAAgBC,OAAhB,EAHA;AAILC,uBAAK/B,KAAK4B,KAAL,CAAWI,EAAX,CAAcF,OAAd;AAJA,iBAXO;AAiBdG,sBAAM,EAAEC,WAAW,KAAb,EAAoBxE,MAAM,KAA1B;AAjBQ,eAAhB;;AAoBA0C,uBAAS+B,MAAT,CAAgBzB,UAAhB;;AAEA,kBAAM0B,aAAa;AACjBpD,sBAAMgB,KAAKhB,IAAL,CAAU,CAAV,EAAaQ,SADF;AAEjB6C,uBAAOrC,KAAK9B,KAAL,CAAWT,SAAX,CAAqBG;AAFX,eAAnB;;AAKAP,gBAAEiF,IAAF,CAAO5B,UAAP,EAAmB,CAAC0B,UAAD,CAAnB,EAAiCjB,OAAjC;AACD;AACF;;;;QA7J8BhE,gB;;;;AAgKjCW,kBAAYyE,WAAZ,GAA0B,aAA1B","file":"starter_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport './css/starter-panel.css!';\nimport TimeSeries from 'app/core/time_series2';\n\nconst panelDefaults = {\n  bgColor: null,\n  sparkline: {\n    show: true,\n    full: false,\n    lineColor: 'rgb(31, 120, 193)',\n    fillColor: 'rgba(31, 118, 189, 0.18)',\n  },\n};\n\nexport class StarterCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    // Set panel defaults for properties that the user has not set explicitly\n    _.defaultsDeep(this.panel, panelDefaults);\n\n    // init-edit-mode event is triggered when the user clicks on edit\n    // the editor tabs are initialized in the handler\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    // The panel-teardown event is useful for cleaning up to avoid memory leaks\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n\n    // The panel initialized event can be useful for panels that inherit PanelCtrl instead of MetricsPanelCtrl\n    // With a MetricsPanelCtrl panel, you usually want to wait for some data to be received\n    this.events.on('panel-initialized', this.render.bind(this));\n\n    // The data-received event is triggered when the datasource returns with data\n    this.events.on('data-received', this.onDataReceived.bind(this));\n\n    // The data-error event can be handled by showing a friendly error message to the user or to ignore the error\n    this.events.on('data-error', this.onDataError.bind(this));\n\n    // The data-snapshot-load event is triggered when the dashboard is loading as a snapshot\n    // Read more about saving and loading snapshot data here:\n    this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n\n    this.onSparklineColorChange = this.onSparklineColorChange.bind(this);\n    this.onSparklineFillChange = this.onSparklineFillChange.bind(this);\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/grafana-starter-panel/editor.html', 2);\n  }\n\n  onPanelTeardown() {\n  }\n\n  onDataReceived(dataList) {\n    if (!dataList) return;\n\n    this.data = dataList.map(this.seriesHandler.bind(this));\n    this.render();\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints || [],\n      alias: seriesData.target,\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  onDataError() {\n    this.onDataReceived();\n  }\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData);\n  }\n\n  onSparklineColorChange(newColor) {\n    this.panel.sparkline.lineColor = newColor;\n    this.render();\n  }\n\n  onSparklineFillChange(newColor) {\n    this.panel.sparkline.fillColor = newColor;\n    this.render();\n  }\n\n  /*\n  The link function is an Angular function that can be used to access the HTML element for the panel\n  */\n  /* eslint class-methods-use-this: 0 */\n  link(scope, elem, attrs, ctrl) {\n    this.events.on('render', () => {\n      const $panelContainer = elem.find('.panel-container');\n\n      if (this.panel.bgColor) {\n        $panelContainer.css('background-color', this.panel.bgColor);\n      } else {\n        $panelContainer.css('background-color', '');\n      }\n\n      if (!ctrl.data) {\n        return;\n      }\n\n      const rootElem = elem.find('.temp-sparkline');\n\n      addSparklines(rootElem);\n    });\n\n    function addSparklines(rootElem) {\n      const width = elem.width() + 20;\n      if (width < 30) {\n        // element has not gotten it's width yet\n        // delay sparkline render\n        setTimeout(() => addSparklines(rootElem), 30);\n        return;\n      }\n\n      rootElem.empty();\n\n      const height = ctrl.height;\n      const plotCanvas = $('<div></div>');\n      const plotCss = {};\n      plotCss.position = 'absolute';\n\n      if (ctrl.panel.sparkline.full) {\n        plotCss.bottom = '5px';\n        plotCss.left = '-5px';\n        plotCss.width = width - 10 + 'px';\n        const dynamicHeightMargin = height <= 100 ? 5 : Math.round(height / 100) * 15 + 5;\n        plotCss.height = height - dynamicHeightMargin + 'px';\n      } else {\n        plotCss.bottom = '0px';\n        plotCss.left = '-5px';\n        plotCss.width = width - 10 + 'px';\n        plotCss.height = Math.floor(height * 0.25) + 'px';\n      }\n\n      plotCanvas.css(plotCss);\n\n      const options = {\n        legend: { show: false },\n        series: {\n          lines: {\n            show: true,\n            fill: 1,\n            lineWidth: 1,\n            fillColor: ctrl.panel.sparkline.fillColor,\n          },\n        },\n        yaxes: { show: false },\n        xaxis: {\n          show: false,\n          mode: 'time',\n          min: ctrl.range.from.valueOf(),\n          max: ctrl.range.to.valueOf(),\n        },\n        grid: { hoverable: false, show: false },\n      };\n\n      rootElem.append(plotCanvas);\n\n      const plotSeries = {\n        data: ctrl.data[0].flotpairs,\n        color: ctrl.panel.sparkline.lineColor,\n      };\n\n      $.plot(plotCanvas, [plotSeries], options);\n    }\n  }\n}\n\nStarterCtrl.templateUrl = 'module.html';\n"]}